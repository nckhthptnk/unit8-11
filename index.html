<!doctype html>
<html lang="vi">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unit 8: Health and Life Expectancy</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .flashcard {
            perspective: 1000px;
            cursor: pointer;
        }
        
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            border-radius: 1rem;
        }
        
        .flashcard-back {
            transform: rotateY(180deg);
        }
        
        .highlight {
            background-color: #fef08a;
            padding: 0 0.25rem;
            border-radius: 0.25rem;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s;
        }
        
        @keyframes correctAnswer {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes wrongAnswer {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .correct-animation {
            animation: correctAnswer 0.5s ease;
        }
        
        .wrong-animation {
            animation: wrongAnswer 0.5s ease;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full">
  <div id="app" class="min-h-full"></div>
  <script>
        const defaultConfig = {
            unit_title: "Unit 8: Health and Life expectancy",
            home_button_text: "Quay v·ªÅ trang ch·ªß",
            background_color: "#f0f9ff",
            surface_color: "#ffffff",
            text_color: "#1e293b",
            primary_action_color: "#3b82f6",
            secondary_action_color: "#64748b",
            font_family: "Segoe UI",
            font_size: 16
        };

        let currentData = [];
        let currentFlashcardIndex = 0;
        let currentSection = 'vocab';
        let isFlipped = false;
        let currentGrammarTopic = null;
        let userAnswers = {};

        const vocabularyData = [
            {
                word: "war",
                ipa: "/w…îÀê(r)/",
                type: "noun",
                meaning: "chi·∫øn tranh",
                example: "The war caused great suffering for many families."
            },
            {
                word: "homeless",
                ipa: "/Ààh…ô äml…ôs/",
                type: "adjective",
                meaning: "v√¥ gia c∆∞",
                example: "Many homeless people need shelter and food."
            },
            {
                word: "disease",
                ipa: "/d…™ÀàziÀêz/",
                type: "noun",
                meaning: "b·ªánh t·∫≠t",
                example: "This disease affects millions of people worldwide."
            },
            {
                word: "hunger",
                ipa: "/Ààh å≈ã…°…ô(r)/",
                type: "noun",
                meaning: "ƒë√≥i kh√°t",
                example: "Hunger is still a major problem in many countries."
            },
            {
                word: "unemployment",
                ipa: "/Àå ån…™mÀàpl…î…™m…ônt/",
                type: "noun",
                meaning: "th·∫•t nghi·ªáp",
                example: "High unemployment rates affect the economy badly."
            },
            {
                word: "racism",
                ipa: "/Ààre…™s…™z…ôm/",
                type: "noun",
                meaning: "ph√¢n bi·ªát ch·ªßng t·ªôc",
                example: "We must fight against racism in all its forms."
            },
            {
                word: "solve",
                ipa: "/s…ílv/",
                type: "verb",
                meaning: "gi·∫£i quy·∫øt",
                example: "We need to solve this problem together."
            },
            {
                word: "affordable",
                ipa: "/…ôÀàf…îÀêd…ôbl/",
                type: "adjective",
                meaning: "c√≥ th·ªÉ chi tr·∫£ ƒë∆∞·ª£c",
                example: "We need more affordable housing for everyone."
            },
            {
                word: "respect",
                ipa: "/r…™Ààspekt/",
                type: "noun/verb",
                meaning: "t√¥n tr·ªçng",
                example: "Everyone deserves respect regardless of their background."
            },
            {
                word: "collect",
                ipa: "/k…ôÀàlekt/",
                type: "verb",
                meaning: "thu th·∫≠p",
                example: "We collect donations for charity every month."
            },
            {
                word: "nationality",
                ipa: "/Àån√¶ É…ôÀàn√¶l…ôti/",
                type: "noun",
                meaning: "qu·ªëc t·ªãch",
                example: "People of all nationalities live in this city."
            },
            {
                word: "non-profit",
                ipa: "/n…ín Ààpr…íf…™t/",
                type: "adjective",
                meaning: "phi l·ª£i nhu·∫≠n",
                example: "She works for a non-profit organization."
            },
            {
                word: "organization",
                ipa: "/Àå…îÀê…°…ôna…™Ààze…™ Én/",
                type: "noun",
                meaning: "t·ªï ch·ª©c",
                example: "This organization helps poor children get education."
            },
            {
                word: "focus on",
                ipa: "/Ààf…ô äk…ôs …ín/",
                type: "phrasal verb",
                meaning: "t·∫≠p trung v√†o",
                example: "We should focus on solving the most urgent problems first."
            },
            {
                word: "deal with",
                ipa: "/diÀêl w…™√∞/",
                type: "phrasal verb",
                meaning: "gi·∫£i quy·∫øt, ƒë·ªëi ph√≥ v·ªõi",
                example: "How do we deal with climate change effectively?"
            },
            {
                word: "charity",
                ipa: "/Ààt É√¶r…ôti/",
                type: "noun",
                meaning: "t·ª´ thi·ªán",
                example: "The charity provides food for homeless people."
            },
            {
                word: "effort",
                ipa: "/Ààef…ôt/",
                type: "noun",
                meaning: "n·ªó l·ª±c",
                example: "It takes great effort to solve social problems."
            },
            {
                word: "recognise",
                ipa: "/Ààrek…ô…°na…™z/",
                type: "verb",
                meaning: "nh·∫≠n ra, c√¥ng nh·∫≠n",
                example: "We must recognise the importance of education."
            },
            {
                word: "symptom",
                ipa: "/Ààs…™mpt…ôm/",
                type: "noun",
                meaning: "tri·ªáu ch·ª©ng",
                example: "Fever is a common symptom of many diseases."
            },
            {
                word: "tuberculosis",
                ipa: "/tjuÀêÀåb…úÀêkjuÀàl…ô äs…™s/",
                type: "noun",
                meaning: "b·ªánh lao",
                example: "Tuberculosis is a serious infectious disease."
            },
            {
                word: "malaria",
                ipa: "/m…ôÀàle…ôri…ô/",
                type: "noun",
                meaning: "b·ªánh s·ªët r√©t",
                example: "Malaria is transmitted by mosquitoes."
            },
            {
                word: "scale",
                ipa: "/ske…™l/",
                type: "noun",
                meaning: "quy m√¥",
                example: "The problem exists on a global scale."
            },
            {
                word: "life-threatening",
                ipa: "/la…™f ÀàŒ∏retn…™≈ã/",
                type: "adjective",
                meaning: "ƒëe d·ªça t√≠nh m·∫°ng",
                example: "This is a life-threatening condition that needs immediate treatment."
            },
            {
                word: "invest",
                ipa: "/…™nÀàvest/",
                type: "verb",
                meaning: "ƒë·∫ßu t∆∞",
                example: "Governments should invest more in healthcare."
            },
            {
                word: "crisis",
                ipa: "/Ààkra…™s…™s/",
                type: "noun",
                meaning: "kh·ªßng ho·∫£ng",
                example: "The economic crisis affected many families."
            },
            {
                word: "conduct",
                ipa: "/k…ônÀàd åkt/",
                type: "verb",
                meaning: "ti·∫øn h√†nh",
                example: "Scientists conduct research to find new treatments."
            },
            {
                word: "conflict",
                ipa: "/Ààk…ínfl…™kt/",
                type: "noun",
                meaning: "xung ƒë·ªôt",
                example: "The conflict between the two countries lasted for years."
            },
            {
                word: "accent",
                ipa: "/Àà√¶ksent/",
                type: "noun",
                meaning: "gi·ªçng ƒëi·ªáu",
                example: "She speaks English with a strong French accent."
            },
            {
                word: "steal",
                ipa: "/stiÀêl/",
                type: "verb",
                meaning: "ƒÉn c·∫Øp",
                example: "It's wrong to steal from others."
            },
            {
                word: "candidate",
                ipa: "/Ààk√¶nd…™d…ôt/",
                type: "noun",
                meaning: "·ª©ng vi√™n",
                example: "She is a strong candidate for the job."
            },
            {
                word: "struggle",
                ipa: "/Ààstr å…°l/",
                type: "verb/noun",
                meaning: "ƒë·∫•u tranh, cu·ªôc ƒë·∫•u tranh",
                example: "Many people struggle to find affordable housing."
            },
            {
                word: "movement",
                ipa: "/ÀàmuÀêvm…ônt/",
                type: "noun",
                meaning: "phong tr√†o",
                example: "The civil rights movement changed society."
            },
            {
                word: "poverty",
                ipa: "/Ààp…ív…ôti/",
                type: "noun",
                meaning: "ngh√®o ƒë√≥i",
                example: "Poverty is one of the world's biggest challenges."
            },
            {
                word: "depression",
                ipa: "/d…™Ààpre Én/",
                type: "noun",
                meaning: "tr·∫ßm c·∫£m",
                example: "Depression is a serious mental health condition."
            },
            {
                word: "obesity",
                ipa: "/…ô äÀàbiÀês…ôti/",
                type: "noun",
                meaning: "b√©o ph√¨",
                example: "Obesity increases the risk of many diseases."
            },
            {
                word: "bullying",
                ipa: "/Ààb äli…™≈ã/",
                type: "noun",
                meaning: "b·∫Øt n·∫°t",
                example: "Bullying at school is a serious problem."
            },
            {
                word: "crime",
                ipa: "/kra…™m/",
                type: "noun",
                meaning: "t·ªôi ph·∫°m",
                example: "The police work hard to prevent crime."
            },
            {
                word: "healthcare",
                ipa: "/ÀàhelŒ∏ke…ô(r)/",
                type: "noun",
                meaning: "chƒÉm s√≥c s·ª©c kh·ªèe",
                example: "Good healthcare should be available to everyone."
            },
            {
                word: "pollution",
                ipa: "/p…ôÀàluÀê Én/",
                type: "noun",
                meaning: "√¥ nhi·ªÖm",
                example: "Air pollution is harmful to our health."
            },
            {
                word: "gender inequality",
                ipa: "/Ààd íend…ô(r) Àå…™n…™Ààkw…íl…ôti/",
                type: "noun",
                meaning: "b·∫•t b√¨nh ƒë·∫≥ng gi·ªõi",
                example: "Gender inequality still exists in many workplaces."
            },
            {
                word: "rely on",
                ipa: "/r…™Ààla…™ …ín/",
                type: "phrasal verb",
                meaning: "d·ª±a v√†o, ph·ª• thu·ªôc v√†o",
                example: "Many families rely on government support."
            },
            {
                word: "shelter",
                ipa: "/Àà Éelt…ô(r)/",
                type: "noun",
                meaning: "n∆°i tr√∫ ·∫©n",
                example: "The shelter provides housing for homeless people."
            },
            {
                word: "deliver",
                ipa: "/d…™Ààl…™v…ô(r)/",
                type: "verb",
                meaning: "giao h√†ng, cung c·∫•p",
                example: "The organization delivers food to poor families."
            },
            {
                word: "postpone",
                ipa: "/p…ôÀàsp…ô än/",
                type: "verb",
                meaning: "ho√£n l·∫°i",
                example: "We had to postpone the meeting due to bad weather."
            },
            {
                word: "volunteer",
                ipa: "/Àåv…íl…ônÀàt…™…ô(r)/",
                type: "noun/verb",
                meaning: "t√¨nh nguy·ªán vi√™n, l√†m t√¨nh nguy·ªán",
                example: "Many volunteers help at the local hospital."
            },
            {
                word: "donate",
                ipa: "/d…ô äÀàne…™t/",
                type: "verb",
                meaning: "quy√™n g√≥p",
                example: "People donate money to help disaster victims."
            },
            {
                word: "fundraising",
                ipa: "/Ààf åndre…™z…™≈ã/",
                type: "noun",
                meaning: "g√¢y qu·ªπ",
                example: "The school organized a fundraising event for charity."
            },
            {
                word: "recommend",
                ipa: "/Àårek…ôÀàmend/",
                type: "verb",
                meaning: "khuy√™n, ƒë·ªÅ xu·∫•t",
                example: "Doctors recommend regular exercise for good health."
            },
            {
                word: "difficulty",
                ipa: "/Ààd…™f…™k…ôlti/",
                type: "noun",
                meaning: "kh√≥ khƒÉn",
                example: "Many students face financial difficulties."
            },
            {
                word: "blanket",
                ipa: "/Ààbl√¶≈ãk…™t/",
                type: "noun",
                meaning: "chƒÉn",
                example: "We distributed blankets to homeless people in winter."
            },
            {
                word: "improve",
                ipa: "/…™mÀàpruÀêv/",
                type: "verb",
                meaning: "c·∫£i thi·ªán",
                example: "Education can improve people's lives significantly."
            },
            {
                word: "economy",
                ipa: "/…™Ààk…ín…ômi/",
                type: "noun",
                meaning: "n·ªÅn kinh t·∫ø",
                example: "A strong economy benefits everyone in society."
            },
            {
                word: "campaign",
                ipa: "/k√¶mÀàpe…™n/",
                type: "noun",
                meaning: "chi·∫øn d·ªãch",
                example: "The health campaign raised awareness about smoking."
            },
            {
                word: "protest",
                ipa: "/Ààpr…ô ätest/",
                type: "noun/verb",
                meaning: "bi·ªÉu t√¨nh, ph·∫£n ƒë·ªëi",
                example: "People have the right to peaceful protest."
            },
            {
                word: "fill up",
                ipa: "/f…™l  åp/",
                type: "phrasal verb",
                meaning: "l√†m ƒë·∫ßy",
                example: "Please fill up this form with your personal information."
            },
            {
                word: "cash",
                ipa: "/k√¶ É/",
                type: "noun",
                meaning: "ti·ªÅn m·∫∑t",
                example: "The charity needs cash donations to buy supplies."
            },
            {
                word: "ensure",
                ipa: "/…™nÀà É ä…ô(r)/",
                type: "verb",
                meaning: "ƒë·∫£m b·∫£o",
                example: "We must ensure that everyone has access to clean water."
            },
            {
                word: "burglary",
                ipa: "/Ààb…úÀê…°l…ôri/",
                type: "noun",
                meaning: "tr·ªôm c·∫Øp",
                example: "The police are investigating the burglary at the shop."
            },
            {
                word: "stamp",
                ipa: "/st√¶mp/",
                type: "noun",
                meaning: "tem",
                example: "You need to put a stamp on the envelope before mailing it."
            },
            {
                word: "citizen",
                ipa: "/Ààs…™t…™zn/",
                type: "noun",
                meaning: "c√¥ng d√¢n",
                example: "Every citizen has rights and responsibilities."
            },
            {
                word: "chance",
                ipa: "/t É…ëÀêns/",
                type: "noun",
                meaning: "c∆° h·ªôi",
                example: "Education gives children a chance for a better future."
            },
            {
                word: "assistant",
                ipa: "/…ôÀàs…™st…ônt/",
                type: "noun",
                meaning: "tr·ª£ l√Ω",
                example: "The teaching assistant helps students with their homework."
            },
            {
                word: "training",
                ipa: "/Ààtre…™n…™≈ã/",
                type: "noun",
                meaning: "ƒë√†o t·∫°o",
                example: "Job training programs help unemployed people find work."
            },
            {
                word: "consequently",
                ipa: "/Ààk…íns…™kw…ôntli/",
                type: "adverb",
                meaning: "do ƒë√≥, k·∫øt qu·∫£ l√†",
                example: "It rained heavily; consequently, the match was cancelled."
            },
            {
                word: "physical",
                ipa: "/Ààf…™z…™kl/",
                type: "adjective",
                meaning: "thu·ªôc v·ªÅ th·ªÉ ch·∫•t",
                example: "Regular exercise improves your physical health."
            },
            {
                word: "harmful",
                ipa: "/Ààh…ëÀêmfl/",
                type: "adjective",
                meaning: "c√≥ h·∫°i",
                example: "Smoking is harmful to your health."
            },
            {
                word: "keen on",
                ipa: "/kiÀên …ín/",
                type: "adjective phrase",
                meaning: "th√≠ch th√∫, quan t√¢m",
                example: "She is keen on helping disadvantaged children."
            }
        ];

        const readingText = `
            <p>Global health challenges require urgent attention from governments and <span class="highlight">organizations</span> worldwide. <span class="highlight">Poverty</span> remains one of the biggest obstacles to achieving good <span class="highlight">healthcare</span> for all. Many people cannot afford basic medical services, and this creates a serious <span class="highlight">crisis</span> in developing countries.</p>
            
            <p><span class="highlight">Disease</span> outbreaks like <span class="highlight">tuberculosis</span> and <span class="highlight">malaria</span> continue to threaten millions of lives, especially in areas affected by <span class="highlight">war</span> and <span class="highlight">conflict</span>. These <span class="highlight">life-threatening</span> conditions require immediate medical <span class="highlight">treatment</span>, but many <span class="highlight">homeless</span> and displaced people lack access to proper care. <span class="highlight">Volunteers</span> from <span class="highlight">non-profit</span> organizations work tirelessly to <span class="highlight">deliver</span> medicine and <span class="highlight">collect</span> donations to help those in need.</p>
            
            <p>To <span class="highlight">solve</span> these problems, governments must <span class="highlight">invest</span> more in <span class="highlight">affordable</span> healthcare systems. We must <span class="highlight">focus on</span> prevention and education to <span class="highlight">improve</span> public health. Every <span class="highlight">citizen</span> deserves the <span class="highlight">chance</span> to live a healthy life, regardless of their <span class="highlight">nationality</span> or economic status. Only through collective <span class="highlight">effort</span> can we <span class="highlight">ensure</span> that quality healthcare becomes accessible to everyone.</p>
        `;

        const readingQuestions = [
            {
                question: "What is one of the biggest obstacles to achieving good healthcare for all?",
                options: [
                    "Lack of doctors",
                    "Poverty",
                    "Bad weather",
                    "Language barriers"
                ],
                correct: 1
            },
            {
                question: "Which diseases are mentioned as continuing to threaten millions of lives?",
                options: [
                    "Cancer and diabetes",
                    "Tuberculosis and malaria",
                    "Heart disease and stroke",
                    "Flu and cold"
                ],
                correct: 1
            },
            {
                question: "Who works to deliver medicine and collect donations?",
                options: [
                    "Government officials",
                    "Volunteers from non-profit organizations",
                    "Private companies",
                    "International banks"
                ],
                correct: 1
            },
            {
                question: "What must governments do to solve healthcare problems?",
                options: [
                    "Build more hospitals only",
                    "Invest more in affordable healthcare systems",
                    "Hire more doctors only",
                    "Reduce healthcare costs only"
                ],
                correct: 1
            },
            {
                question: "According to the text, what does every citizen deserve?",
                options: [
                    "Free education",
                    "The chance to live a healthy life",
                    "A good job",
                    "Expensive medicine"
                ],
                correct: 1
            }
        ];

        const grammarTopics = {
            must_vs_have_to: {
                title: "Modals: must vs have to",
                content: `
                    <h3 class="font-bold mb-4" style="font-size: 1.25em;">Must vs Have to</h3>
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold mb-2" style="font-size: 1.1em;">MUST</h4>
                            <ul class="list-disc pl-6 space-y-2">
                                <li>Di·ªÖn t·∫£ s·ª± b·∫Øt bu·ªôc t·ª´ ng∆∞·ªùi n√≥i (personal obligation)</li>
                                <li>V√≠ d·ª•: You must see a doctor. (T√¥i nghƒ© b·∫°n ph·∫£i ƒëi kh√°m b√°c sƒ©)</li>
                                <li>Di·ªÖn t·∫£ lu·∫≠t l·ªá, quy ƒë·ªãnh: Students must wear uniforms.</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2" style="font-size: 1.1em;">HAVE TO</h4>
                            <ul class="list-disc pl-6 space-y-2">
                                <li>Di·ªÖn t·∫£ s·ª± b·∫Øt bu·ªôc t·ª´ b√™n ngo√†i (external obligation)</li>
                                <li>V√≠ d·ª•: I have to take this medicine. (B√°c sƒ© b·∫£o t√¥i ph·∫£i u·ªëng thu·ªëc n√†y)</li>
                                <li>C√≥ th·ªÉ chia theo th√¨: had to (qu√° kh·ª©), will have to (t∆∞∆°ng lai)</li>
                            </ul>
                        </div>
                    </div>
                `
            },
            mustnt_vs_dont_have_to: {
                title: "Ph√¢n bi·ªát mustn't vs don't/doesn't have to",
                content: `
                    <h3 class="font-bold mb-4" style="font-size: 1.25em;">Mustn't vs Don't/Doesn't Have To</h3>
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold mb-2" style="font-size: 1.1em;">MUSTN'T</h4>
                            <ul class="list-disc pl-6 space-y-2">
                                <li>Di·ªÖn t·∫£ s·ª± c·∫•m ƒëo√°n (prohibition)</li>
                                <li>V√≠ d·ª•: You mustn't smoke here. (B·∫°n kh√¥ng ƒë∆∞·ª£c h√∫t thu·ªëc ·ªü ƒë√¢y)</li>
                                <li>= It's forbidden / You are not allowed to</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2" style="font-size: 1.1em;">DON'T/DOESN'T HAVE TO</h4>
                            <ul class="list-disc pl-6 space-y-2">
                                <li>Di·ªÖn t·∫£ s·ª± kh√¥ng c·∫ßn thi·∫øt (not necessary)</li>
                                <li>V√≠ d·ª•: You don't have to come early. (B·∫°n kh√¥ng c·∫ßn ƒë·∫øn s·ªõm)</li>
                                <li>= It's not necessary / You don't need to</li>
                            </ul>
                        </div>
                    </div>
                `
            }
        };

        const vocabularyQuiz = [
            { question: "What does 'war' mean?", options: ["h√≤a b√¨nh", "chi·∫øn tranh", "th·ªèa thu·∫≠n", "ƒë√†m ph√°n"], correct: 1 },
            { question: "Choose the correct meaning of 'homeless':", options: ["c√≥ nh√†", "v√¥ gia c∆∞", "gi√†u c√≥", "ngh√®o kh√≥"], correct: 1 },
            { question: "What is the meaning of 'disease'?", options: ["s·ª©c kh·ªèe", "thu·ªëc men", "b·ªánh t·∫≠t", "b√°c sƒ©"], correct: 2 },
            { question: "'Hunger' means:", options: ["no", "ƒë√≥i kh√°t", "kh√°t n∆∞·ªõc", "ƒÉn u·ªëng"], correct: 1 },
            { question: "What does 'unemployment' refer to?", options: ["c√≥ vi·ªác l√†m", "th·∫•t nghi·ªáp", "ngh·ªâ h∆∞u", "l√†m vi·ªác"], correct: 1 },
            { question: "'Racism' is:", options: ["b√¨nh ƒë·∫≥ng", "ph√¢n bi·ªát ch·ªßng t·ªôc", "h√≤a h·ª£p", "ƒëo√†n k·∫øt"], correct: 1 },
            { question: "To 'solve' means:", options: ["t·∫°o ra", "gi·∫£i quy·∫øt", "ph√° h·ªßy", "b·ªè qua"], correct: 1 },
            { question: "'Affordable' means:", options: ["ƒë·∫Øt ƒë·ªè", "mi·ªÖn ph√≠", "c√≥ th·ªÉ chi tr·∫£ ƒë∆∞·ª£c", "kh√¥ng th·ªÉ mua"], correct: 2 },
            { question: "What does 'respect' mean?", options: ["t√¥n tr·ªçng", "coi th∆∞·ªùng", "gh√©t b·ªè", "ph·ªõt l·ªù"], correct: 0 },
            { question: "To 'collect' means:", options: ["n√©m b·ªè", "thu th·∫≠p", "ph√¢n t√°n", "m·∫•t m√°t"], correct: 1 },
            { question: "'Nationality' refers to:", options: ["t√¥n gi√°o", "qu·ªëc t·ªãch", "ngh·ªÅ nghi·ªáp", "tu·ªïi t√°c"], correct: 1 },
            { question: "A 'non-profit' organization:", options: ["ki·∫øm l·ªùi", "phi l·ª£i nhu·∫≠n", "t∆∞ nh√¢n", "ch√≠nh ph·ªß"], correct: 1 },
            { question: "'Organization' means:", options: ["c√° nh√¢n", "t·ªï ch·ª©c", "gia ƒë√¨nh", "b·∫°n b√®"], correct: 1 },
            { question: "To 'focus on' means:", options: ["b·ªè qua", "t·∫≠p trung v√†o", "ph√¢n t√°n", "l√£ng qu√™n"], correct: 1 },
            { question: "'Deal with' means:", options: ["tr√°nh n√©", "gi·∫£i quy·∫øt", "t·∫°o ra", "ph√° h·ªßy"], correct: 1 },
            { question: "'Charity' refers to:", options: ["kinh doanh", "t·ª´ thi·ªán", "ch√≠nh tr·ªã", "gi·∫£i tr√≠"], correct: 1 },
            { question: "An 'effort' is:", options: ["s·ª± l∆∞·ªùi bi·∫øng", "n·ªó l·ª±c", "th·∫•t b·∫°i", "may m·∫Øn"], correct: 1 },
            { question: "To 'recognise' means:", options: ["ph·ªß nh·∫≠n", "nh·∫≠n ra", "qu√™n l√£ng", "che gi·∫•u"], correct: 1 },
            { question: "A 'symptom' is:", options: ["nguy√™n nh√¢n", "tri·ªáu ch·ª©ng", "k·∫øt qu·∫£", "ph∆∞∆°ng ph√°p"], correct: 1 },
            { question: "'Tuberculosis' is:", options: ["b·ªánh tim", "b·ªánh lao", "b·ªánh gan", "b·ªánh th·∫≠n"], correct: 1 },
            { question: "'Malaria' is transmitted by:", options: ["ch√≥", "m√®o", "mu·ªói", "chu·ªôt"], correct: 2 },
            { question: "'Scale' refers to:", options: ["m√†u s·∫Øc", "quy m√¥", "h√¨nh d·∫°ng", "tr·ªçng l∆∞·ª£ng"], correct: 1 },
            { question: "'Life-threatening' means:", options: ["an to√†n", "ƒëe d·ªça t√≠nh m·∫°ng", "vui v·∫ª", "b√¨nh th∆∞·ªùng"], correct: 1 },
            { question: "To 'invest' means:", options: ["ti√™u x√†i", "ƒë·∫ßu t∆∞", "vay m∆∞·ª£n", "cho t·∫∑ng"], correct: 1 },
            { question: "A 'crisis' is:", options: ["th√†nh c√¥ng", "kh·ªßng ho·∫£ng", "c∆° h·ªôi", "ni·ªÅm vui"], correct: 1 },
            { question: "To 'conduct' means:", options: ["ng·ª´ng l·∫°i", "ti·∫øn h√†nh", "ph√° h·ªßy", "tr√°nh n√©"], correct: 1 },
            { question: "A 'conflict' is:", options: ["h√≤a b√¨nh", "xung ƒë·ªôt", "th·ªèa thu·∫≠n", "h·ª£p t√°c"], correct: 1 },
            { question: "An 'accent' is:", options: ["gi·ªçng ƒëi·ªáu", "t·ª´ v·ª±ng", "ng·ªØ ph√°p", "ch·ªØ vi·∫øt"], correct: 0 },
            { question: "To 'steal' means:", options: ["cho t·∫∑ng", "ƒÉn c·∫Øp", "mua b√°n", "trao ƒë·ªïi"], correct: 1 },
            { question: "A 'candidate' is:", options: ["ng∆∞·ªùi th·∫Øng cu·ªôc", "·ª©ng vi√™n", "ng∆∞·ªùi thua cu·ªôc", "kh√°n gi·∫£"], correct: 1 },
            { question: "To 'struggle' means:", options: ["th√†nh c√¥ng", "ƒë·∫•u tranh", "ngh·ªâ ng∆°i", "vui ch∆°i"], correct: 1 },
            { question: "A 'movement' is:", options: ["s·ª± ƒë·ª©ng y√™n", "phong tr√†o", "c√° nh√¢n", "t√≤a nh√†"], correct: 1 },
            { question: "'Poverty' means:", options: ["gi√†u c√≥", "ngh√®o ƒë√≥i", "b√¨nh th∆∞·ªùng", "xa hoa"], correct: 1 },
            { question: "'Depression' is:", options: ["h·∫°nh ph√∫c", "tr·∫ßm c·∫£m", "ph·∫•n kh√≠ch", "b√¨nh th∆∞·ªùng"], correct: 1 },
            { question: "'Obesity' refers to:", options: ["g·∫ßy y·∫øu", "b√©o ph√¨", "c√¢n ƒë·ªëi", "cao l·ªõn"], correct: 1 },
            { question: "'Bullying' is:", options: ["gi√∫p ƒë·ª°", "b·∫Øt n·∫°t", "khen ng·ª£i", "ƒë·ªông vi√™n"], correct: 1 },
            { question: "'Crime' refers to:", options: ["vi·ªác t·ªët", "t·ªôi ph·∫°m", "c√¥ng vi·ªác", "s·ªü th√≠ch"], correct: 1 },
            { question: "'Healthcare' means:", options: ["gi√°o d·ª•c", "chƒÉm s√≥c s·ª©c kh·ªèe", "gi·∫£i tr√≠", "th·ªÉ thao"], correct: 1 },
            { question: "'Pollution' is:", options: ["s·∫°ch s·∫Ω", "√¥ nhi·ªÖm", "trong l√†nh", "t∆∞∆°i m·ªõi"], correct: 1 },
            { question: "'Gender inequality' refers to:", options: ["b√¨nh ƒë·∫≥ng gi·ªõi", "b·∫•t b√¨nh ƒë·∫≥ng gi·ªõi", "nam gi·ªõi", "n·ªØ gi·ªõi"], correct: 1 },
            { question: "To 'rely on' means:", options: ["t·ª´ ch·ªëi", "d·ª±a v√†o", "tr√°nh xa", "ph·∫£n ƒë·ªëi"], correct: 1 },
            { question: "A 'shelter' is:", options: ["n∆°i nguy hi·ªÉm", "n∆°i tr√∫ ·∫©n", "n∆°i l√†m vi·ªác", "n∆°i vui ch∆°i"], correct: 1 },
            { question: "To 'deliver' means:", options: ["nh·∫≠n", "giao h√†ng", "mua", "b√°n"], correct: 1 },
            { question: "To 'postpone' means:", options: ["ti·∫øn h√†nh ngay", "ho√£n l·∫°i", "h·ªßy b·ªè", "th√∫c ƒë·∫©y"], correct: 1 },
            { question: "A 'volunteer' is:", options: ["ng∆∞·ªùi ƒë∆∞·ª£c tr·∫£ l∆∞∆°ng", "t√¨nh nguy·ªán vi√™n", "s·∫øp", "kh√°ch h√†ng"], correct: 1 },
            { question: "To 'donate' means:", options: ["nh·∫≠n", "quy√™n g√≥p", "mua", "b√°n"], correct: 1 },
            { question: "'Fundraising' is:", options: ["ti√™u ti·ªÅn", "g√¢y qu·ªπ", "vay ti·ªÅn", "cho vay"], correct: 1 },
            { question: "To 'recommend' means:", options: ["ph·∫£n ƒë·ªëi", "khuy√™n", "c·∫•m", "b·ªè qua"], correct: 1 },
            { question: "A 'difficulty' is:", options: ["d·ªÖ d√†ng", "kh√≥ khƒÉn", "thu·∫≠n l·ª£i", "may m·∫Øn"], correct: 1 },
            { question: "A 'blanket' is:", options: ["g·ªëi", "chƒÉn", "n·ªám", "m√†n"], correct: 1 },
            { question: "To 'improve' means:", options: ["l√†m x·∫•u ƒëi", "c·∫£i thi·ªán", "gi·ªØ nguy√™n", "ph√° h·ªßy"], correct: 1 },
            { question: "The 'economy' refers to:", options: ["ch√≠nh tr·ªã", "n·ªÅn kinh t·∫ø", "vƒÉn h√≥a", "x√£ h·ªôi"], correct: 1 },
            { question: "A 'campaign' is:", options: ["cu·ªôc thi", "chi·∫øn d·ªãch", "l·ªÖ h·ªôi", "bu·ªïi ti·ªác"], correct: 1 },
            { question: "To 'protest' means:", options: ["·ªßng h·ªô", "bi·ªÉu t√¨nh", "ƒë·ªìng √Ω", "khen ng·ª£i"], correct: 1 },
            { question: "'Fill up' means:", options: ["l√†m r·ªóng", "l√†m ƒë·∫ßy", "l√†m s·∫°ch", "l√†m b·∫©n"], correct: 1 },
            { question: "'Cash' refers to:", options: ["th·∫ª t√≠n d·ª•ng", "ti·ªÅn m·∫∑t", "s√©c", "chuy·ªÉn kho·∫£n"], correct: 1 },
            { question: "To 'ensure' means:", options: ["nghi ng·ªù", "ƒë·∫£m b·∫£o", "t·ª´ ch·ªëi", "ph·ªß nh·∫≠n"], correct: 1 },
            { question: "'Burglary' is:", options: ["mua b√°n", "tr·ªôm c·∫Øp", "cho t·∫∑ng", "trao ƒë·ªïi"], correct: 1 },
            { question: "A 'stamp' is used for:", options: ["ƒÉn", "tem", "vi·∫øt", "v·∫Ω"], correct: 1 },
            { question: "A 'citizen' is:", options: ["kh√°ch du l·ªãch", "c√¥ng d√¢n", "ng∆∞·ªùi n∆∞·ªõc ngo√†i", "doanh nh√¢n"], correct: 1 },
            { question: "A 'chance' is:", options: ["th·∫•t b·∫°i", "c∆° h·ªôi", "kh√≥ khƒÉn", "tr·ªü ng·∫°i"], correct: 1 },
            { question: "An 'assistant' is:", options: ["s·∫øp", "tr·ª£ l√Ω", "kh√°ch h√†ng", "ƒë·ªëi th·ªß"], correct: 1 },
            { question: "'Training' refers to:", options: ["ngh·ªâ ng∆°i", "ƒë√†o t·∫°o", "vui ch∆°i", "du l·ªãch"], correct: 1 },
            { question: "'Consequently' means:", options: ["tr∆∞·ªõc ƒë√≥", "do ƒë√≥", "m·∫∑c d√π", "tuy nhi√™n"], correct: 1 },
            { question: "'Physical' relates to:", options: ["tinh th·∫ßn", "th·ªÉ ch·∫•t", "c·∫£m x√∫c", "tr√≠ tu·ªá"], correct: 1 },
            { question: "'Harmful' means:", options: ["c√≥ l·ª£i", "c√≥ h·∫°i", "trung t√≠nh", "t·ªët"], correct: 1 },
            { question: "'Keen on' means:", options: ["gh√©t", "th√≠ch th√∫", "s·ª£ h√£i", "b·ªè qua"], correct: 1 },
            { question: "Which word means 'chi·∫øn tranh'?", options: ["peace", "war", "agreement", "treaty"], correct: 1 },
            { question: "Which word means 't√¥n tr·ªçng'?", options: ["disrespect", "ignore", "respect", "hate"], correct: 2 },
            { question: "Which word means 'c·∫£i thi·ªán'?", options: ["worsen", "maintain", "destroy", "improve"], correct: 3 }
        ];

        const lifeExpectancyText = `
            <h3 style="color: #2563eb; font-weight: bold; margin-bottom: 1rem;">ü•ó HOW TO EAT FOR LONGEVITY</h3>
            <p><strong>‚úÖ What to do:</strong> Eat <span class="highlight">5 servings of fruits and vegetables</span> daily - this is the secret of Japanese people who live the longest in the world. <span class="highlight">Drink green tea</span> instead of coffee, eat <span class="highlight">salmon and mackerel</span> rich in omega-3. Choose <span class="highlight">brown rice and oats</span> instead of white rice.</p>
            <p><strong>‚ùå Avoid:</strong> Fast food, processed foods, too much sugar and salt. Limit red meat to only 2 times per week.</p>
            
            <h3 style="color: #16a34a; font-weight: bold; margin-bottom: 1rem; margin-top: 2rem;">üèÉ HOW TO EXERCISE EFFECTIVELY</h3>
            <p><strong>The 3-2-1 Rule:</strong> <span class="highlight">30 minutes of brisk walking</span> daily, <span class="highlight">20 minutes of strength training</span> twice a week, <span class="highlight">10 minutes of stretching</span> before bed. Elderly people should practice <span class="highlight">tai chi</span> to improve physical and mental health.</p>
            <p><strong>Helpful tips:</strong> Take stairs instead of elevators, park farther to walk more, doing housework is also exercise!</p>
            
            <h3 style="color: #dc2626; font-weight: bold; margin-bottom: 1rem; margin-top: 2rem;">üò¥ HOW TO SLEEP AND REST</h3>
            <p><strong>Sleep properly:</strong> <span class="highlight">Go to bed before 11 PM</span>, turn off your phone 1 hour before sleep. Keep bedroom <span class="highlight">dark, cool, and quiet</span>. Take 15-20 minute naps if possible.</p>
            <p><strong>Reduce stress:</strong> Practice <span class="highlight">4-7-8 breathing</span> (inhale 4 seconds, hold 7 seconds, exhale 8 seconds). Listen to relaxing music, read books instead of watching TV.</p>
            
            <h3 style="color: #7c3aed; font-weight: bold; margin-bottom: 1rem; margin-top: 2rem;">üë• HOW TO BUILD RELATIONSHIPS</h3>
            <p><strong>Social connections:</strong> <span class="highlight">Call friends</span> at least once a week, join <span class="highlight">clubs and community activities</span>. People with many friends live 50% longer than lonely people!</p>
            <p><strong>Love and care:</strong> Keep pets, care for plants, help others - these activities help the brain release happiness hormones.</p>
            
            <h3 style="color: #ea580c; font-weight: bold; margin-bottom: 1rem; margin-top: 2rem;">üß† HOW TO KEEP YOUR BRAIN HEALTHY</h3>
            <p><strong>Lifelong learning:</strong> <span class="highlight">Learn foreign languages, play chess</span>, solve crosswords, read books daily. Try <span class="highlight">new hobbies</span> like painting, cooking, gardening.</p>
            <p><strong>Meditation:</strong> Just <span class="highlight">10 minutes of meditation</span> each morning helps reduce 23% risk of stroke and heart attack!</p>
        `;

        // Life Expectancy questions removed - content only section

        const grammarExercises = [
            { question: "You ___ wear a helmet when riding a motorcycle.", options: ["must", "have to", "both A and B"], correct: 2 },
            { question: "I ___ finish this report by tomorrow. My boss said so.", options: ["must", "have to", "both A and B"], correct: 1 },
            { question: "You ___ eat in the library. It's against the rules.", options: ["mustn't", "don't have to", "both A and B"], correct: 0 },
            { question: "You ___ bring your own lunch. We'll provide food.", options: ["mustn't", "don't have to", "both A and B"], correct: 1 },
            { question: "Students ___ submit their assignments on time.", options: ["must", "have to", "both A and B"], correct: 2 },
            { question: "We ___ go to school yesterday because it was Sunday.", options: ["mustn't", "didn't have to", "both A and B"], correct: 1 },
            { question: "You ___ touch that wire. It's dangerous!", options: ["mustn't", "don't have to", "both A and B"], correct: 0 },
            { question: "She ___ work late tonight. Her manager asked her to.", options: ["must", "has to", "both A and B"], correct: 1 },
            { question: "You ___ shout in the hospital.", options: ["mustn't", "don't have to", "both A and B"], correct: 0 },
            { question: "I ___ get up early tomorrow. It's my day off.", options: ["mustn't", "don't have to", "both A and B"], correct: 1 },
            { question: "You ___ exercise regularly to stay healthy.", options: ["must", "have to", "both A and B"], correct: 0 },
            { question: "They ___ wear uniforms at their new school.", options: ["must", "have to", "both A and B"], correct: 1 },
            { question: "You ___ park here. It's a no-parking zone.", options: ["mustn't", "don't have to", "both A and B"], correct: 0 },
            { question: "We ___ hurry. We have plenty of time.", options: ["mustn't", "don't have to", "both A and B"], correct: 1 },
            { question: "You ___ be 18 to vote in elections.", options: ["must", "have to", "both A and B"], correct: 2 },
            { question: "I ___ take this medicine three times a day.", options: ["must", "have to", "both A and B"], correct: 1 },
            { question: "You ___ use your phone during the exam.", options: ["mustn't", "don't have to", "both A and B"], correct: 0 },
            { question: "You ___ come if you're busy. It's optional.", options: ["mustn't", "don't have to", "both A and B"], correct: 1 },
            { question: "Drivers ___ stop at red lights.", options: ["must", "have to", "both A and B"], correct: 2 },
            { question: "She ___ work tomorrow. It's a public holiday.", options: ["mustn't", "doesn't have to", "both A and B"], correct: 1 },
            { question: "You ___ be quiet in the library.", options: ["must", "have to", "both A and B"], correct: 2 },
            { question: "We ___ pay for the tickets. They're free.", options: ["mustn't", "don't have to", "both A and B"], correct: 1 },
            { question: "You ___ smoke near the gas station.", options: ["mustn't", "don't have to", "both A and B"], correct: 0 },
            { question: "I ___ attend the meeting. My boss insists.", options: ["must", "have to", "both A and B"], correct: 1 },
            { question: "You ___ bring anything. We have everything.", options: ["mustn't", "don't have to", "both A and B"], correct: 1 },
            { question: "Children ___ play with matches.", options: ["mustn't", "don't have to", "both A and B"], correct: 0 },
            { question: "You ___ have a passport to travel abroad.", options: ["must", "have to", "both A and B"], correct: 2 },
            { question: "We ___ book in advance. There are plenty of seats.", options: ["mustn't", "don't have to", "both A and B"], correct: 1 },
            { question: "You ___ tell anyone about this. It's confidential.", options: ["mustn't", "don't have to", "both A and B"], correct: 0 },
            { question: "I ___ wake up early tomorrow for my flight.", options: ["must", "have to", "both A and B"], correct: 1 }
        ];

        const dataHandler = {
            onDataChanged(data) {
                console.log('üìä Data changed received:', data);
                currentData = data;
                updateProgressDisplay();
                
                // Force update total progress after data sync
                setTimeout(() => {
                    console.log('üîÑ Force updating total progress after data sync');
                    updateTotalProgress();
                }, 200);
            }
        };

        async function initializeApp() {
            try {
                const initResult = await window.dataSdk.init(dataHandler);
                if (!initResult.isOk) {
                    console.error("Failed to initialize data SDK");
                }
                
                if (window.elementSdk) {
                    window.elementSdk.init({
                        defaultConfig,
                        onConfigChange: async (config) => {
                            await renderApp(config);
                        },
                        mapToCapabilities: (config) => ({
                            recolorables: [
                                {
                                    get: () => config.background_color || defaultConfig.background_color,
                                    set: (value) => {
                                        config.background_color = value;
                                        window.elementSdk.setConfig({ background_color: value });
                                    }
                                },
                                {
                                    get: () => config.surface_color || defaultConfig.surface_color,
                                    set: (value) => {
                                        config.surface_color = value;
                                        window.elementSdk.setConfig({ surface_color: value });
                                    }
                                },
                                {
                                    get: () => config.text_color || defaultConfig.text_color,
                                    set: (value) => {
                                        config.text_color = value;
                                        window.elementSdk.setConfig({ text_color: value });
                                    }
                                },
                                {
                                    get: () => config.primary_action_color || defaultConfig.primary_action_color,
                                    set: (value) => {
                                        config.primary_action_color = value;
                                        window.elementSdk.setConfig({ primary_action_color: value });
                                    }
                                },
                                {
                                    get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                                    set: (value) => {
                                        config.secondary_action_color = value;
                                        window.elementSdk.setConfig({ secondary_action_color: value });
                                    }
                                }
                            ],
                            borderables: [],
                            fontEditable: {
                                get: () => config.font_family || defaultConfig.font_family,
                                set: (value) => {
                                    config.font_family = value;
                                    window.elementSdk.setConfig({ font_family: value });
                                }
                            },
                            fontSizeable: {
                                get: () => config.font_size || defaultConfig.font_size,
                                set: (value) => {
                                    config.font_size = value;
                                    window.elementSdk.setConfig({ font_size: value });
                                }
                            }
                        }),
                        mapToEditPanelValues: (config) => new Map([
                            ["unit_title", config.unit_title || defaultConfig.unit_title],
                            ["home_button_text", config.home_button_text || defaultConfig.home_button_text]
                        ])
                    });
                }
                
                await renderApp(window.elementSdk?.config || defaultConfig);
            } catch (error) {
                console.error("Error initializing app:", error);
                // Fallback render without SDK
                await renderApp(defaultConfig);
            }
        }

        async function renderApp(config) {
            const app = document.getElementById('app');
            const customFont = config.font_family || defaultConfig.font_family;
            const baseSize = config.font_size || defaultConfig.font_size;
            const bgColor = config.background_color || defaultConfig.background_color;
            const surfaceColor = config.surface_color || defaultConfig.surface_color;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            
            document.body.style.backgroundColor = bgColor;
            document.body.style.color = textColor;
            document.body.style.fontFamily = `${customFont}, Arial, sans-serif`;
            document.body.style.fontSize = `${baseSize}px`;
            
            const progress = calculateProgress();
            
            app.innerHTML = `
                <div class="min-h-full p-4 md:p-8">
                    <div class="max-w-6xl mx-auto">
                        <!-- Header -->
                        <div class="mb-8">
                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-4">
                                <!-- Home button always on the left -->
                                <a href="https://nckhthptnk.github.io/tienganh11/" target="_blank" rel="noopener noreferrer" 
                                   class="px-3 py-2 sm:px-4 sm:py-2 rounded-lg transition-colors flex-shrink-0 self-start sm:self-center" 
                                   style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, Arial, sans-serif;">
                                    ${config.home_button_text || defaultConfig.home_button_text}
                                </a>
                                
                                <!-- Title centered -->
                                <h1 class="font-bold text-center flex-1 sm:absolute sm:left-1/2 sm:transform sm:-translate-x-1/2" 
                                   style="font-size: ${baseSize * 1.5}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                                    ${config.unit_title || defaultConfig.unit_title}
                                </h1>
                                
                                <!-- Spacer to balance layout on larger screens -->
                                <div class="hidden sm:block sm:w-24"></div>
                            </div>
                            
                            <!-- Progress Section -->
                            <div class="rounded-xl p-6 shadow-lg" style="background-color: ${surfaceColor};">
                                <h2 class="font-bold mb-4" style="font-size: ${baseSize * 1.5}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">Ti·∫øn ƒë·ªô h·ªçc t·∫≠p</h2>
                                <div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                                    ${createProgressCircle('T·ªïng', progress.total, baseSize, customFont, textColor, primaryColor)}
                                    ${createProgressCircle('T·ª´ v·ª±ng', progress.vocab, baseSize, customFont, textColor, primaryColor)}
                                    ${createProgressCircle('B√†i ƒë·ªçc', progress.reading, baseSize, customFont, textColor, primaryColor)}
                                    ${createProgressCircle('Ng·ªØ ph√°p', progress.grammar, baseSize, customFont, textColor, primaryColor)}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section Tabs -->
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-6">
                            <button onclick="switchSection('vocab')" id="tab-vocab" class="px-3 py-3 sm:px-6 rounded-lg font-semibold transition-colors text-center" style="font-size: ${baseSize * 0.875}px; font-family: ${customFont}, Arial, sans-serif;">
                                T·ª´ v·ª±ng
                            </button>
                            <button onclick="switchSection('reading')" id="tab-reading" class="px-3 py-3 sm:px-6 rounded-lg font-semibold transition-colors text-center" style="font-size: ${baseSize * 0.875}px; font-family: ${customFont}, Arial, sans-serif;">
                                B√†i ƒë·ªçc
                            </button>
                            <button onclick="switchSection('grammar')" id="tab-grammar" class="px-3 py-3 sm:px-6 rounded-lg font-semibold transition-colors text-center" style="font-size: ${baseSize * 0.875}px; font-family: ${customFont}, Arial, sans-serif;">
                                Ng·ªØ ph√°p
                            </button>
                            <button onclick="switchSection('life-expectancy')" id="tab-life-expectancy" class="px-3 py-3 sm:px-6 rounded-lg font-semibold transition-colors text-center" style="font-size: ${baseSize * 0.875}px; font-family: ${customFont}, Arial, sans-serif;">
                                Life Expectancy
                            </button>
                        </div>
                        
                        <!-- Content Area -->
                        <div id="content-area" class="rounded-xl p-6 shadow-lg" style="background-color: ${surfaceColor};">
                        </div>
                    </div>
                </div>
            `;
            
            updateTabStyles(config);
            renderContent(config);
        }

        function createProgressCircle(label, percentage, baseSize, font, textColor, primaryColor) {
            const radius = 35;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percentage / 100) * circumference;
            
            return `
                <div class="flex flex-col items-center">
                    <svg width="90" height="90" class="progress-ring">
                        <circle cx="45" cy="45" r="${radius}" stroke="#e5e7eb" stroke-width="6" fill="none"/>
                        <circle cx="45" cy="45" r="${radius}" stroke="${primaryColor}" stroke-width="6" fill="none"
                                class="progress-ring-circle"
                                style="stroke-dasharray: ${circumference}; stroke-dashoffset: ${offset};"/>
                    </svg>
                    <div class="text-center mt-1 sm:mt-2">
                        <div class="font-bold" style="font-size: ${baseSize * 1.1}px; color: ${textColor}; font-family: ${font}, Arial, sans-serif;">${percentage}%</div>
                        <div class="text-xs sm:text-sm" style="color: ${textColor}; font-family: ${font}, Arial, sans-serif;">${label}</div>
                    </div>
                </div>
            `;
        }

        let currentVocabQuestion = -1;

        function renderVocabQuiz(container, config) {
            const baseSize = config.font_size || defaultConfig.font_size;
            const customFont = config.font_family || defaultConfig.font_family;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            
            if (currentVocabQuestion === -1) {
                // Show quiz menu
                container.innerHTML = `
                    <div class="max-w-4xl mx-auto">
                        <button onclick="backToVocabMenu()" 
                                class="mb-6 px-4 py-2 rounded-lg transition-colors"
                                style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;">
                            ‚Üê Quay l·∫°i
                        </button>
                        
                        <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.5}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                            Ki·ªÉm tra t·ª´ v·ª±ng (67 c√¢u)
                        </h2>
                        
                        <div class="flex justify-center">
                            <button onclick="startVocabQuiz()" 
                                    class="px-8 py-4 rounded-lg font-bold text-lg transition-colors"
                                    style="background-color: ${primaryColor}; color: white; font-size: ${baseSize * 1.1}px; font-family: ${customFont}, Arial, sans-serif;">
                                B·∫Øt ƒë·∫ßu ki·ªÉm tra ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            } else {
                // Show current question
                const q = vocabularyQuiz[currentVocabQuestion];
                const isAnswered = userAnswers[`vocab-${currentVocabQuestion}`] !== undefined;
                
                container.innerHTML = `
                    <div class="max-w-4xl mx-auto">
                        <div class="mb-6 flex justify-between items-center">
                            <button onclick="backToVocabQuizMenu()" 
                                    class="px-4 py-2 rounded-lg transition-colors"
                                    style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;">
                                ‚Üê Quay l·∫°i menu
                            </button>
                            <div style="font-size: ${baseSize}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                                C√¢u ${currentVocabQuestion + 1} / ${vocabularyQuiz.length}
                            </div>
                        </div>
                        
                        <div class="p-6 rounded-lg mb-6" style="background-color: rgba(0,0,0,0.05);">
                            <div class="font-bold mb-4" style="font-size: ${baseSize * 1.25}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                                ${q.question}
                            </div>
                            
                            <div class="space-y-3">
                                ${q.options.map((opt, optIdx) => `
                                    <button onclick="checkVocabAnswer(${currentVocabQuestion}, ${optIdx})" 
                                            id="vocab-q${currentVocabQuestion}-opt${optIdx}"
                                            class="w-full text-left p-4 rounded-lg transition-colors ${isAnswered ? 'cursor-not-allowed' : 'hover:bg-gray-100'}"
                                            style="background-color: white; color: ${textColor}; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif; border: 2px solid #e5e7eb;"
                                            ${isAnswered ? 'disabled' : ''}>
                                        ${String.fromCharCode(65 + optIdx)}. ${opt}
                                    </button>
                                `).join('')}
                            </div>
                            
                            <div id="vocab-feedback-${currentVocabQuestion}" class="mt-4" style="font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;"></div>
                        </div>
                        
                        <div class="flex justify-between">
                            <button onclick="previousVocabQuestion()" 
                                    class="px-6 py-3 rounded-lg font-semibold transition-colors ${currentVocabQuestion === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                                    style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;"
                                    ${currentVocabQuestion === 0 ? 'disabled' : ''}>
                                ‚Üê Tr∆∞·ªõc
                            </button>
                            
                            <button onclick="nextVocabQuestion()" 
                                    class="px-6 py-3 rounded-lg font-semibold transition-colors ${currentVocabQuestion === vocabularyQuiz.length - 1 ? 'opacity-50 cursor-not-allowed' : ''}"
                                    style="background-color: ${primaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;"
                                    ${currentVocabQuestion === vocabularyQuiz.length - 1 ? 'disabled' : ''}>
                                Ti·∫øp ‚Üí
                            </button>
                        </div>
                    </div>
                `;
                
                // Restore previous answer if exists
                if (isAnswered) {
                    restoreVocabAnswer(currentVocabQuestion);
                }
            }
        }

        function switchSection(section) {
            currentSection = section;
            currentFlashcardIndex = 0;
            isFlipped = false;
            currentGrammarTopic = null;
            currentVocabMode = 'menu';
            currentReadingQuestion = -1;
            currentLifeExpectancyQuestion = -1;
            currentGrammarQuestion = -1;
            currentVocabQuestion = -1;
            userAnswers = {};
            const config = window.elementSdk?.config || defaultConfig;
            updateTabStyles(config);
            renderContent(config);
        }

        function updateTabStyles(config) {
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            const textColor = config.text_color || defaultConfig.text_color;
            
            ['vocab', 'reading', 'grammar', 'life-expectancy'].forEach(section => {
                const tab = document.getElementById(`tab-${section}`);
                if (tab) {
                    if (section === currentSection) {
                        tab.style.backgroundColor = primaryColor;
                        tab.style.color = 'white';
                    } else {
                        tab.style.backgroundColor = secondaryColor;
                        tab.style.color = 'white';
                    }
                }
            });
        }

        function renderContent(config) {
            const contentArea = document.getElementById('content-area');
            const baseSize = config.font_size || defaultConfig.font_size;
            const customFont = config.font_family || defaultConfig.font_family;
            const textColor = config.text_color || defaultConfig.text_color;
            const surfaceColor = config.surface_color || defaultConfig.surface_color;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            
            if (currentSection === 'vocab') {
                renderVocabSection(contentArea, config);
            } else if (currentSection === 'reading') {
                renderReading(contentArea, config);
            } else if (currentSection === 'life-expectancy') {
                renderLifeExpectancy(contentArea, config);
            } else if (currentSection === 'grammar') {
                renderGrammar(contentArea, config);
            }
        }

        let currentVocabMode = 'menu'; // 'menu', 'flashcard', 'quiz'

        function renderVocabSection(container, config) {
            const baseSize = config.font_size || defaultConfig.font_size;
            const customFont = config.font_family || defaultConfig.font_family;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            
            if (currentVocabMode === 'menu') {
                container.innerHTML = `
                    <div class="max-w-4xl mx-auto">
                        <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.5}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                            Ch·ªçn c√°ch h·ªçc t·ª´ v·ª±ng
                        </h2>
                        
                        <div class="grid gap-4">
                            <button onclick="selectVocabMode('flashcard')" 
                                    class="p-6 rounded-lg text-left transition-colors"
                                    style="background-color: ${primaryColor}; color: white; font-size: ${baseSize * 1.1}px; font-family: ${customFont}, Arial, sans-serif;">
                                <div class="font-bold mb-2">üìö H·ªçc t·ª´ Flashcard</div>
                                <div style="font-size: ${baseSize * 0.875}px;">H·ªçc t·ª´ v·ª±ng qua th·∫ª ghi nh·ªõ v·ªõi 58 t·ª´</div>
                            </button>
                            
                            <button onclick="selectVocabMode('quiz')" 
                                    class="p-6 rounded-lg text-left transition-colors"
                                    style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize * 1.1}px; font-family: ${customFont}, Arial, sans-serif;">
                                <div class="font-bold mb-2">üìù Ki·ªÉm tra t·ª´ v·ª±ng</div>
                                <div style="font-size: ${baseSize * 0.875}px;">67 c√¢u tr·∫Øc nghi·ªám ki·ªÉm tra t·ª´ v·ª±ng</div>
                            </button>
                        </div>
                    </div>
                `;
            } else if (currentVocabMode === 'flashcard') {
                renderVocabFlashcard(container, config);
            } else if (currentVocabMode === 'quiz') {
                renderVocabQuiz(container, config);
            }
        }

        function renderVocabFlashcard(container, config) {
            const vocab = vocabularyData[currentFlashcardIndex];
            const baseSize = config.font_size || defaultConfig.font_size;
            const customFont = config.font_family || defaultConfig.font_family;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            
            container.innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <button onclick="backToVocabMenu()" 
                            class="mb-6 px-4 py-2 rounded-lg transition-colors"
                            style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;">
                        ‚Üê Quay l·∫°i
                    </button>
                    
                    <div class="text-center mb-4" style="font-size: ${baseSize}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                        Th·∫ª ${currentFlashcardIndex + 1} / ${vocabularyData.length}
                    </div>
                    
                    <div class="flashcard ${isFlipped ? 'flipped' : ''}" onclick="flipCard()" style="height: 300px; max-height: 50vh;">
                        <div class="flashcard-inner">
                            <div class="flashcard-front" style="background-color: ${primaryColor}; color: white;">
                                <div class="text-center" style="font-size: ${baseSize * 2}px; font-weight: bold; font-family: ${customFont}, Arial, sans-serif;">
                                    ${vocab.word}
                                </div>
                                <div class="text-center" style="font-size: ${baseSize * 1.1}px; margin-top: 0.75rem; font-family: ${customFont}, Arial, sans-serif;">
                                    ${vocab.ipa}
                                </div>
                                <button onclick="event.stopPropagation(); pronounceWord('${vocab.word}')" 
                                        class="mt-3 px-3 py-2 rounded-lg transition-colors text-sm"
                                        style="background-color: rgba(255,255,255,0.2); color: white; font-size: ${baseSize * 0.8}px; font-family: ${customFont}, Arial, sans-serif; border: 1px solid rgba(255,255,255,0.3);">
                                    üîä Ph√°t √¢m
                                </button>
                                <div class="text-center text-sm sm:text-base" style="font-size: ${baseSize * 0.8}px; margin-top: 0.75rem; font-style: italic; font-family: ${customFont}, Arial, sans-serif;">
                                    Nh·∫•n ƒë·ªÉ l·∫≠t th·∫ª
                                </div>
                            </div>
                            
                            <div class="flashcard-back" style="background-color: ${secondaryColor}; color: white;">
                                <div class="text-center" style="font-size: ${baseSize * 1.3}px; font-weight: bold; margin-bottom: 0.75rem; font-family: ${customFont}, Arial, sans-serif;">
                                    ${vocab.meaning}
                                </div>
                                <div class="text-center" style="font-size: ${baseSize * 0.9}px; margin-bottom: 0.5rem; font-family: ${customFont}, Arial, sans-serif;">
                                    <span style="font-style: italic;">${vocab.type}</span>
                                </div>
                                <div class="text-center px-2" style="font-size: ${baseSize * 0.8}px; margin-top: 1rem; font-family: ${customFont}, Arial, sans-serif; line-height: 1.4;">
                                    <strong>V√≠ d·ª•:</strong><br>${vocab.example}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-center gap-2 sm:gap-4 mt-6 flex-wrap">
                        <button onclick="previousCard()" class="px-4 py-2 sm:px-6 sm:py-3 rounded-lg font-semibold transition-colors text-sm sm:text-base" 
                                style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, Arial, sans-serif;"
                                ${currentFlashcardIndex === 0 ? 'disabled style="opacity: 0.5;"' : ''}>
                            ‚Üê L√πi
                        </button>
                        <button onclick="flipCard()" class="px-4 py-2 sm:px-6 sm:py-3 rounded-lg font-semibold transition-colors text-sm sm:text-base" 
                                style="background-color: ${primaryColor}; color: white; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, Arial, sans-serif;">
                            L·∫≠t th·∫ª
                        </button>
                        <button onclick="nextCard()" class="px-4 py-2 sm:px-6 sm:py-3 rounded-lg font-semibold transition-colors text-sm sm:text-base" 
                                style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, Arial, sans-serif;"
                                ${currentFlashcardIndex === vocabularyData.length - 1 ? 'disabled style="opacity: 0.5;"' : ''}>
                            Ti·∫øp ‚Üí
                        </button>
                    </div>
                </div>
            `;
        }

        let currentReadingQuestion = 0;

        function renderReading(container, config) {
            const baseSize = config.font_size || defaultConfig.font_size;
            const customFont = config.font_family || defaultConfig.font_family;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            
            if (currentReadingQuestion === -1) {
                // Show reading text
                container.innerHTML = `
                    <div class="max-w-4xl mx-auto">
                        <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.5}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                            B√†i ƒë·ªçc: Health and Longevity
                        </h2>
                        
                        <div class="mb-8 leading-relaxed space-y-4" style="font-size: ${baseSize}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                            ${readingText}
                        </div>
                        
                        <div class="flex justify-center">
                            <button onclick="startReadingQuiz()" 
                                    class="px-8 py-4 rounded-lg font-bold text-lg transition-colors"
                                    style="background-color: ${primaryColor}; color: white; font-size: ${baseSize * 1.1}px; font-family: ${customFont}, Arial, sans-serif;">
                                B·∫Øt ƒë·∫ßu l√†m c√¢u h·ªèi ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            } else {
                // Show current question
                const q = readingQuestions[currentReadingQuestion];
                const isAnswered = userAnswers[`reading-${currentReadingQuestion}`] !== undefined;
                
                container.innerHTML = `
                    <div class="max-w-4xl mx-auto">
                        <div class="mb-6 flex justify-between items-center">
                            <button onclick="backToReadingText()" 
                                    class="px-4 py-2 rounded-lg transition-colors"
                                    style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;">
                                ‚Üê Quay l·∫°i b√†i ƒë·ªçc
                            </button>
                            <div style="font-size: ${baseSize}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                                C√¢u ${currentReadingQuestion + 1} / ${readingQuestions.length}
                            </div>
                        </div>
                        
                        <div class="p-6 rounded-lg mb-6" style="background-color: rgba(0,0,0,0.05);">
                            <div class="font-bold mb-4" style="font-size: ${baseSize * 1.25}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                                ${q.question}
                            </div>
                            
                            <div class="space-y-3">
                                ${q.options.map((opt, optIdx) => `
                                    <button onclick="checkReadingAnswer(${currentReadingQuestion}, ${optIdx})" 
                                            id="reading-q${currentReadingQuestion}-opt${optIdx}"
                                            class="w-full text-left p-4 rounded-lg transition-colors ${isAnswered ? 'cursor-not-allowed' : 'hover:bg-gray-100'}"
                                            style="background-color: white; color: ${textColor}; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif; border: 2px solid #e5e7eb;"
                                            ${isAnswered ? 'disabled' : ''}>
                                        ${String.fromCharCode(65 + optIdx)}. ${opt}
                                    </button>
                                `).join('')}
                            </div>
                            
                            <div id="reading-feedback-${currentReadingQuestion}" class="mt-4" style="font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;"></div>
                        </div>
                        
                        <div class="flex justify-between">
                            <button onclick="previousReadingQuestion()" 
                                    class="px-6 py-3 rounded-lg font-semibold transition-colors ${currentReadingQuestion === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                                    style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;"
                                    ${currentReadingQuestion === 0 ? 'disabled' : ''}>
                                ‚Üê Tr∆∞·ªõc
                            </button>
                            
                            <button onclick="nextReadingQuestion()" 
                                    class="px-6 py-3 rounded-lg font-semibold transition-colors ${currentReadingQuestion === readingQuestions.length - 1 ? 'opacity-50 cursor-not-allowed' : ''}"
                                    style="background-color: ${primaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;"
                                    ${currentReadingQuestion === readingQuestions.length - 1 ? 'disabled' : ''}>
                                Ti·∫øp ‚Üí
                            </button>
                        </div>
                    </div>
                `;
                
                // Restore previous answer if exists
                if (isAnswered) {
                    restoreReadingAnswer(currentReadingQuestion);
                }
            }
        }

        let currentLifeExpectancyQuestion = -1;

        function renderLifeExpectancy(container, config) {
            const baseSize = config.font_size || defaultConfig.font_size;
            const customFont = config.font_family || defaultConfig.font_family;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            
            // Always show life expectancy content (no questions)
            container.innerHTML = `
                <div class="max-w-4xl mx-auto">
                    <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.5}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                        Life Expectancy - How to Live Longer and Healthier
                    </h2>
                    
                    <div class="mb-8 leading-relaxed space-y-4" style="font-size: ${baseSize}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                        ${lifeExpectancyText}
                    </div>
                    
                    <div class="text-center mt-8">
                        <div class="p-4 rounded-lg mb-4" style="background-color: rgba(34, 197, 94, 0.1); border: 2px solid #22c55e;">
                            <div class="font-bold mb-2" style="color: #16a34a; font-size: ${baseSize * 1.1}px; font-family: ${customFont}, Arial, sans-serif;">
                                üéâ Congratulations! You've completed the Life Expectancy section!
                            </div>
                            <div style="color: ${textColor}; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;">
                                You now have practical tips for living a longer, healthier life. Your progress has been automatically updated to 100%.
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Automatically set progress to 100% when viewing content
            setTimeout(async () => {
                await saveProgress('life-expectancy', 100);
            }, 1000);
        }

        function renderGrammar(container, config) {
            const baseSize = config.font_size || defaultConfig.font_size;
            const customFont = config.font_family || defaultConfig.font_family;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            
            if (!currentGrammarTopic) {
                container.innerHTML = `
                    <div class="max-w-4xl mx-auto">
                        <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.5}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                            Ch·ªçn n·ªôi dung h·ªçc
                        </h2>
                        
                        <div class="grid gap-4">
                            <button onclick="selectGrammarTopic('must_vs_have_to')" 
                                    class="p-6 rounded-lg text-left transition-colors"
                                    style="background-color: ${primaryColor}; color: white; font-size: ${baseSize * 1.1}px; font-family: ${customFont}, Arial, sans-serif;">
                                <div class="font-bold mb-2">Modals: must vs have to</div>
                                <div style="font-size: ${baseSize * 0.875}px;">H·ªçc c√°ch s·ª≠ d·ª•ng must v√† have to</div>
                            </button>
                            
                            <button onclick="selectGrammarTopic('mustnt_vs_dont_have_to')" 
                                    class="p-6 rounded-lg text-left transition-colors"
                                    style="background-color: ${primaryColor}; color: white; font-size: ${baseSize * 1.1}px; font-family: ${customFont}, Arial, sans-serif;">
                                <div class="font-bold mb-2">Ph√¢n bi·ªát mustn't vs don't/doesn't have to</div>
                                <div style="font-size: ${baseSize * 0.875}px;">Hi·ªÉu s·ª± kh√°c bi·ªát gi·ªØa c·∫•m ƒëo√°n v√† kh√¥ng c·∫ßn thi·∫øt</div>
                            </button>
                            
                            <button onclick="selectGrammarTopic('exercises')" 
                                    class="p-6 rounded-lg text-left transition-colors"
                                    style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize * 1.1}px; font-family: ${customFont}, Arial, sans-serif;">
                                <div class="font-bold mb-2">B√†i t·∫≠p t·ªïng h·ª£p</div>
                                <div style="font-size: ${baseSize * 0.875}px;">30 c√¢u tr·∫Øc nghi·ªám</div>
                            </button>
                        </div>
                    </div>
                `;
            } else if (currentGrammarTopic === 'exercises') {
                renderGrammarExercises(container, config);
            } else {
                const topic = grammarTopics[currentGrammarTopic];
                container.innerHTML = `
                    <div class="max-w-4xl mx-auto">
                        <button onclick="backToGrammarMenu()" 
                                class="mb-6 px-4 py-2 rounded-lg transition-colors"
                                style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;">
                            ‚Üê Quay l·∫°i
                        </button>
                        
                        <div class="prose max-w-none" style="color: ${textColor}; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;">
                            ${topic.content}
                        </div>
                    </div>
                `;
            }
        }

        let currentGrammarQuestion = -1;

        function renderGrammarExercises(container, config) {
            const baseSize = config.font_size || defaultConfig.font_size;
            const customFont = config.font_family || defaultConfig.font_family;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            
            if (currentGrammarQuestion === -1) {
                // Show exercise menu
                container.innerHTML = `
                    <div class="max-w-4xl mx-auto">
                        <button onclick="backToGrammarMenu()" 
                                class="mb-6 px-4 py-2 rounded-lg transition-colors"
                                style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;">
                            ‚Üê Quay l·∫°i
                        </button>
                        
                        <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.5}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                            B√†i t·∫≠p t·ªïng h·ª£p (30 c√¢u)
                        </h2>
                        
                        <div class="flex justify-center">
                            <button onclick="startGrammarExercises()" 
                                    class="px-8 py-4 rounded-lg font-bold text-lg transition-colors"
                                    style="background-color: ${primaryColor}; color: white; font-size: ${baseSize * 1.1}px; font-family: ${customFont}, Arial, sans-serif;">
                                B·∫Øt ƒë·∫ßu l√†m b√†i t·∫≠p ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            } else {
                // Show current question
                const q = grammarExercises[currentGrammarQuestion];
                const isAnswered = userAnswers[`grammar-${currentGrammarQuestion}`] !== undefined;
                
                container.innerHTML = `
                    <div class="max-w-4xl mx-auto">
                        <div class="mb-6 flex justify-between items-center">
                            <button onclick="backToGrammarExerciseMenu()" 
                                    class="px-4 py-2 rounded-lg transition-colors"
                                    style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;">
                                ‚Üê Quay l·∫°i menu
                            </button>
                            <div style="font-size: ${baseSize}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                                C√¢u ${currentGrammarQuestion + 1} / ${grammarExercises.length}
                            </div>
                        </div>
                        
                        <div class="p-6 rounded-lg mb-6" style="background-color: rgba(0,0,0,0.05);">
                            <div class="font-bold mb-4" style="font-size: ${baseSize * 1.25}px; color: ${textColor}; font-family: ${customFont}, Arial, sans-serif;">
                                ${q.question}
                            </div>
                            
                            <div class="space-y-3">
                                ${q.options.map((opt, optIdx) => `
                                    <button onclick="checkGrammarAnswer(${currentGrammarQuestion}, ${optIdx})" 
                                            id="grammar-q${currentGrammarQuestion}-opt${optIdx}"
                                            class="w-full text-left p-4 rounded-lg transition-colors ${isAnswered ? 'cursor-not-allowed' : 'hover:bg-gray-100'}"
                                            style="background-color: white; color: ${textColor}; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif; border: 2px solid #e5e7eb;"
                                            ${isAnswered ? 'disabled' : ''}>
                                        ${String.fromCharCode(65 + optIdx)}. ${opt}
                                    </button>
                                `).join('')}
                            </div>
                            
                            <div id="grammar-feedback-${currentGrammarQuestion}" class="mt-4" style="font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;"></div>
                        </div>
                        
                        <div class="flex justify-between">
                            <button onclick="previousGrammarQuestion()" 
                                    class="px-6 py-3 rounded-lg font-semibold transition-colors ${currentGrammarQuestion === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                                    style="background-color: ${secondaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;"
                                    ${currentGrammarQuestion === 0 ? 'disabled' : ''}>
                                ‚Üê Tr∆∞·ªõc
                            </button>
                            
                            <button onclick="nextGrammarQuestion()" 
                                    class="px-6 py-3 rounded-lg font-semibold transition-colors ${currentGrammarQuestion === grammarExercises.length - 1 ? 'opacity-50 cursor-not-allowed' : ''}"
                                    style="background-color: ${primaryColor}; color: white; font-size: ${baseSize}px; font-family: ${customFont}, Arial, sans-serif;"
                                    ${currentGrammarQuestion === grammarExercises.length - 1 ? 'disabled' : ''}>
                                Ti·∫øp ‚Üí
                            </button>
                        </div>
                    </div>
                `;
                
                // Restore previous answer if exists
                if (isAnswered) {
                    restoreGrammarAnswer(currentGrammarQuestion);
                }
            }
        }

        function flipCard() {
            isFlipped = !isFlipped;
            const flashcard = document.querySelector('.flashcard');
            if (flashcard) {
                if (isFlipped) {
                    flashcard.classList.add('flipped');
                } else {
                    flashcard.classList.remove('flipped');
                }
            }
        }

        function nextCard() {
            if (currentFlashcardIndex < vocabularyData.length - 1) {
                currentFlashcardIndex++;
                isFlipped = false;
                const config = window.elementSdk?.config || defaultConfig;
                renderContent(config);
                updateVocabProgress();
                
                // Auto-pronounce the new word after a short delay
                setTimeout(() => {
                    const newWord = vocabularyData[currentFlashcardIndex].word;
                    pronounceWord(newWord);
                }, 300);
            }
        }

        function previousCard() {
            if (currentFlashcardIndex > 0) {
                currentFlashcardIndex--;
                isFlipped = false;
                const config = window.elementSdk?.config || defaultConfig;
                renderContent(config);
                
                // Auto-pronounce the new word after a short delay
                setTimeout(() => {
                    const newWord = vocabularyData[currentFlashcardIndex].word;
                    pronounceWord(newWord);
                }, 300);
            }
        }

        function selectGrammarTopic(topic) {
            currentGrammarTopic = topic;
            userAnswers = {};
            const config = window.elementSdk?.config || defaultConfig;
            renderContent(config);
        }

        function backToGrammarMenu() {
            currentGrammarTopic = null;
            const config = window.elementSdk?.config || defaultConfig;
            renderContent(config);
        }

        function startReadingQuiz() {
            currentReadingQuestion = 0;
            const config = window.elementSdk?.config || defaultConfig;
            renderContent(config);
        }

        function backToReadingText() {
            currentReadingQuestion = -1;
            const config = window.elementSdk?.config || defaultConfig;
            renderContent(config);
        }

        function nextReadingQuestion() {
            if (currentReadingQuestion < readingQuestions.length - 1) {
                currentReadingQuestion++;
                const config = window.elementSdk?.config || defaultConfig;
                renderContent(config);
            }
        }

        function previousReadingQuestion() {
            if (currentReadingQuestion > 0) {
                currentReadingQuestion--;
                const config = window.elementSdk?.config || defaultConfig;
                renderContent(config);
            }
        }

        function restoreReadingAnswer(questionIdx) {
            const question = readingQuestions[questionIdx];
            const userAnswer = userAnswers[`reading-${questionIdx}`];
            const selectedOption = userAnswers[`reading-selected-${questionIdx}`];
            
            if (selectedOption !== undefined) {
                // Restore the visual state
                for (let i = 0; i < question.options.length; i++) {
                    const btn = document.getElementById(`reading-q${questionIdx}-opt${i}`);
                    if (btn) {
                        btn.disabled = true;
                        btn.style.cursor = 'not-allowed';
                        
                        if (i === question.correct) {
                            // Always highlight the correct answer in green
                            btn.style.backgroundColor = '#22c55e';
                            btn.style.color = 'white';
                            btn.style.border = '2px solid #16a34a';
                            btn.style.fontWeight = 'bold';
                            btn.style.opacity = '1';
                        } else if (i === selectedOption && !userAnswer) {
                            // Highlight wrong answer in red
                            btn.style.backgroundColor = '#ef4444';
                            btn.style.color = 'white';
                            btn.style.border = '2px solid #dc2626';
                            btn.style.opacity = '1';
                        } else {
                            // Gray out other options
                            btn.style.backgroundColor = '#f3f4f6';
                            btn.style.color = '#6b7280';
                            btn.style.border = '2px solid #e5e7eb';
                            btn.style.opacity = '0.6';
                        }
                    }
                }
                
                const feedback = document.getElementById(`reading-feedback-${questionIdx}`);
                if (feedback) {
                    if (userAnswer) {
                        feedback.innerHTML = '<span style="color: #22c55e; font-weight: bold;">‚úì Ch√≠nh x√°c!</span>';
                    } else {
                        feedback.innerHTML = `<span style="color: #ef4444; font-weight: bold;">‚úó Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√†: ${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}</span>`;
                    }
                }
            }
        }

        async function checkReadingAnswer(questionIdx, optionIdx) {
            const question = readingQuestions[questionIdx];
            const isCorrect = optionIdx === question.correct;
            const config = window.elementSdk?.config || defaultConfig;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            
            // Play sound based on answer
            if (isCorrect) {
                playCorrectSound();
            } else {
                playWrongSound();
            }
            
            // Disable all buttons for this question to prevent multiple answers
            for (let i = 0; i < question.options.length; i++) {
                const btn = document.getElementById(`reading-q${questionIdx}-opt${i}`);
                if (btn) {
                    btn.disabled = true;
                    btn.style.cursor = 'not-allowed';
                    
                    if (i === question.correct) {
                        // Always highlight the correct answer in green
                        btn.style.backgroundColor = '#22c55e';
                        btn.style.color = 'white';
                        btn.style.border = '2px solid #16a34a';
                        btn.style.fontWeight = 'bold';
                        btn.style.opacity = '1';
                    } else if (i === optionIdx && !isCorrect) {
                        // Highlight wrong answer in red
                        btn.style.backgroundColor = '#ef4444';
                        btn.style.color = 'white';
                        btn.style.border = '2px solid #dc2626';
                        btn.style.opacity = '1';
                    } else {
                        // Gray out other options
                        btn.style.backgroundColor = '#f3f4f6';
                        btn.style.color = '#6b7280';
                        btn.style.border = '2px solid #e5e7eb';
                        btn.style.opacity = '0.6';
                    }
                }
            }
            
            const feedback = document.getElementById(`reading-feedback-${questionIdx}`);
            if (feedback) {
                if (isCorrect) {
                    feedback.innerHTML = '<span style="color: #22c55e; font-weight: bold;">‚úì Ch√≠nh x√°c!</span>';
                    feedback.classList.add('correct-animation');
                } else {
                    feedback.innerHTML = `<span style="color: #ef4444; font-weight: bold;">‚úó Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√†: ${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}</span>`;
                    feedback.classList.add('wrong-animation');
                }
            }
            
            userAnswers[`reading-${questionIdx}`] = isCorrect;
            userAnswers[`reading-selected-${questionIdx}`] = optionIdx;
            await updateReadingProgress();
        }

        async function checkGrammarAnswer(questionIdx, optionIdx) {
            const question = grammarExercises[questionIdx];
            const isCorrect = optionIdx === question.correct;
            const config = window.elementSdk?.config || defaultConfig;
            
            // Play sound based on answer
            if (isCorrect) {
                playCorrectSound();
            } else {
                playWrongSound();
            }
            
            // Disable all buttons for this question to prevent multiple answers
            for (let i = 0; i < question.options.length; i++) {
                const btn = document.getElementById(`grammar-q${questionIdx}-opt${i}`);
                if (btn) {
                    btn.disabled = true;
                    btn.style.cursor = 'not-allowed';
                    
                    if (i === question.correct) {
                        // Always highlight the correct answer in green
                        btn.style.backgroundColor = '#22c55e';
                        btn.style.color = 'white';
                        btn.style.border = '2px solid #16a34a';
                        btn.style.fontWeight = 'bold';
                        btn.style.opacity = '1';
                    } else if (i === optionIdx && !isCorrect) {
                        // Highlight wrong answer in red
                        btn.style.backgroundColor = '#ef4444';
                        btn.style.color = 'white';
                        btn.style.border = '2px solid #dc2626';
                        btn.style.opacity = '1';
                    } else {
                        // Gray out other options
                        btn.style.backgroundColor = '#f3f4f6';
                        btn.style.color = '#6b7280';
                        btn.style.border = '2px solid #e5e7eb';
                        btn.style.opacity = '0.6';
                    }
                }
            }
            
            const feedback = document.getElementById(`grammar-feedback-${questionIdx}`);
            if (feedback) {
                if (isCorrect) {
                    feedback.innerHTML = '<span style="color: #22c55e; font-weight: bold;">‚úì Ch√≠nh x√°c!</span>';
                    feedback.classList.add('correct-animation');
                } else {
                    feedback.innerHTML = `<span style="color: #ef4444; font-weight: bold;">‚úó Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√†: ${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}</span>`;
                    feedback.classList.add('wrong-animation');
                }
            }
            
            userAnswers[`grammar-${questionIdx}`] = isCorrect;
            userAnswers[`grammar-selected-${questionIdx}`] = optionIdx;
            await updateGrammarProgress();
        }

        async function checkLifeExpectancyAnswer(questionIdx, optionIdx) {
            const question = lifeExpectancyQuestions[questionIdx];
            const isCorrect = optionIdx === question.correct;
            const config = window.elementSdk?.config || defaultConfig;
            
            // Play sound based on answer
            if (isCorrect) {
                playCorrectSound();
            } else {
                playWrongSound();
            }
            
            // Disable all buttons for this question to prevent multiple answers
            for (let i = 0; i < question.options.length; i++) {
                const btn = document.getElementById(`life-expectancy-q${questionIdx}-opt${i}`);
                if (btn) {
                    btn.disabled = true;
                    btn.style.cursor = 'not-allowed';
                    
                    if (i === question.correct) {
                        // Always highlight the correct answer in green
                        btn.style.backgroundColor = '#22c55e';
                        btn.style.color = 'white';
                        btn.style.border = '2px solid #16a34a';
                        btn.style.fontWeight = 'bold';
                        btn.style.opacity = '1';
                    } else if (i === optionIdx && !isCorrect) {
                        // Highlight wrong answer in red
                        btn.style.backgroundColor = '#ef4444';
                        btn.style.color = 'white';
                        btn.style.border = '2px solid #dc2626';
                        btn.style.opacity = '1';
                    } else {
                        // Gray out other options
                        btn.style.backgroundColor = '#f3f4f6';
                        btn.style.color = '#6b7280';
                        btn.style.border = '2px solid #e5e7eb';
                        btn.style.opacity = '0.6';
                    }
                }
            }
            
            const feedback = document.getElementById(`life-expectancy-feedback-${questionIdx}`);
            if (feedback) {
                if (isCorrect) {
                    feedback.innerHTML = '<span style="color: #22c55e; font-weight: bold;">‚úì Ch√≠nh x√°c!</span>';
                    feedback.classList.add('correct-animation');
                } else {
                    feedback.innerHTML = `<span style="color: #ef4444; font-weight: bold;">‚úó Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√†: ${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}</span>`;
                    feedback.classList.add('wrong-animation');
                }
            }
            
            userAnswers[`life-expectancy-${questionIdx}`] = isCorrect;
            await updateLifeExpectancyProgress();
        }

        function selectVocabMode(mode) {
            currentVocabMode = mode;
            userAnswers = {};
            const config = window.elementSdk?.config || defaultConfig;
            renderContent(config);
        }

        function backToVocabMenu() {
            currentVocabMode = 'menu';
            const config = window.elementSdk?.config || defaultConfig;
            renderContent(config);
        }

        async function checkVocabAnswer(questionIdx, optionIdx) {
            const question = vocabularyQuiz[questionIdx];
            const isCorrect = optionIdx === question.correct;
            const config = window.elementSdk?.config || defaultConfig;
            
            // Play sound based on answer
            if (isCorrect) {
                playCorrectSound();
            } else {
                playWrongSound();
            }
            
            // Disable all buttons for this question to prevent multiple answers
            for (let i = 0; i < question.options.length; i++) {
                const btn = document.getElementById(`vocab-q${questionIdx}-opt${i}`);
                if (btn) {
                    btn.disabled = true;
                    btn.style.cursor = 'not-allowed';
                    
                    if (i === question.correct) {
                        // Always highlight the correct answer in green
                        btn.style.backgroundColor = '#22c55e';
                        btn.style.color = 'white';
                        btn.style.border = '2px solid #16a34a';
                        btn.style.fontWeight = 'bold';
                        btn.style.opacity = '1';
                    } else if (i === optionIdx && !isCorrect) {
                        // Highlight wrong answer in red
                        btn.style.backgroundColor = '#ef4444';
                        btn.style.color = 'white';
                        btn.style.border = '2px solid #dc2626';
                        btn.style.opacity = '1';
                    } else {
                        // Gray out other options
                        btn.style.backgroundColor = '#f3f4f6';
                        btn.style.color = '#6b7280';
                        btn.style.border = '2px solid #e5e7eb';
                        btn.style.opacity = '0.6';
                    }
                }
            }
            
            const feedback = document.getElementById(`vocab-feedback-${questionIdx}`);
            if (feedback) {
                if (isCorrect) {
                    feedback.innerHTML = '<span style="color: #22c55e; font-weight: bold;">‚úì Ch√≠nh x√°c!</span>';
                    feedback.classList.add('correct-animation');
                } else {
                    feedback.innerHTML = `<span style="color: #ef4444; font-weight: bold;">‚úó Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√†: ${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}</span>`;
                    feedback.classList.add('wrong-animation');
                }
            }
            
            userAnswers[`vocab-${questionIdx}`] = isCorrect;
            userAnswers[`vocab-selected-${questionIdx}`] = optionIdx;
            await updateVocabProgress();
        }

        async function updateVocabProgress() {
            let progress = 0;
            if (currentVocabMode === 'flashcard') {
                progress = Math.round(((currentFlashcardIndex + 1) / vocabularyData.length) * 100);
            } else if (currentVocabMode === 'quiz') {
                const answeredCount = Object.keys(userAnswers).filter(k => k.startsWith('vocab-') && !k.includes('selected')).length;
                progress = Math.round((answeredCount / vocabularyQuiz.length) * 100);
            }
            
            console.log(`Updating vocab progress to ${progress}%`);
            await saveProgress('vocab', progress);
            
            // Update display immediately with new progress
            updateProgressCircle(1, progress); // vocab is index 1
            
            // Update total progress after vocab progress changes
            setTimeout(() => {
                updateTotalProgress();
            }, 100);
        }

        async function updateReadingProgress() {
            const answeredCount = Object.keys(userAnswers).filter(k => k.startsWith('reading-') && !k.includes('selected')).length;
            const progress = Math.round((answeredCount / readingQuestions.length) * 100);
            
            console.log(`Updating reading progress to ${progress}%`);
            await saveProgress('reading', progress);
            
            // Update display immediately with new progress
            updateProgressCircle(2, progress); // reading is index 2
            
            // Update total progress after reading progress changes
            setTimeout(() => {
                updateTotalProgress();
            }, 100);
        }

        async function updateGrammarProgress() {
            const answeredCount = Object.keys(userAnswers).filter(k => k.startsWith('grammar-') && !k.includes('selected')).length;
            const progress = Math.round((answeredCount / grammarExercises.length) * 100);
            
            console.log(`Updating grammar progress to ${progress}%`);
            await saveProgress('grammar', progress);
            
            // Update display immediately with new progress
            updateProgressCircle(3, progress); // grammar is index 3
            
            // Update total progress after grammar progress changes
            setTimeout(() => {
                updateTotalProgress();
            }, 100);
        }

        async function updateLifeExpectancyProgress() {
            const answeredCount = Object.keys(userAnswers).filter(k => k.startsWith('life-expectancy-')).length;
            const progress = Math.round((answeredCount / lifeExpectancyQuestions.length) * 100);
            
            console.log(`Updating life expectancy progress to ${progress}%`);
            await saveProgress('life-expectancy', progress);
            
            // Update total progress as well
            updateTotalProgress();
        }

        async function saveProgress(type, value) {
            try {
                console.log(`üîÑ Attempting to save progress: ${type} = ${value}%`);
                
                const existing = currentData.find(d => d.type === type);
                
                if (existing) {
                    // Update existing record
                    const updated = { ...existing, progress: value };
                    console.log('üìù Updating existing record:', updated);
                    
                    const result = await window.dataSdk.update(updated);
                    if (result.isOk) {
                        console.log(`‚úÖ Progress updated successfully: ${type} = ${value}%`);
                        // Update local data immediately
                        const index = currentData.findIndex(d => d.type === type);
                        if (index !== -1) {
                            currentData[index] = updated;
                            console.log('üìä Local data updated:', currentData[index]);
                        }
                        
                        // Force update total progress after successful save
                        setTimeout(() => {
                            console.log('üéØ Updating total progress after successful save');
                            const newProgress = calculateProgress();
                            console.log('üìà New calculated progress:', newProgress);
                            updateProgressCircle(0, newProgress.total);
                        }, 300);
                        
                    } else {
                        console.error('‚ùå Failed to update progress:', result.error);
                    }
                } else {
                    // Create new record
                    const newRecord = {
                        type: type,
                        progress: value
                    };
                    console.log('üÜï Creating new record:', newRecord);
                    
                    const result = await window.dataSdk.create(newRecord);
                    if (result.isOk) {
                        console.log(`‚úÖ Progress created successfully: ${type} = ${value}%`);
                        // Add to local data immediately with temporary ID
                        const tempRecord = { ...newRecord, __backendId: 'temp-' + Date.now() };
                        currentData.push(tempRecord);
                        console.log('üìä Local data added:', tempRecord);
                        
                        // Force update total progress after successful save
                        setTimeout(() => {
                            console.log('üéØ Updating total progress after successful create');
                            const newProgress = calculateProgress();
                            console.log('üìà New calculated progress:', newProgress);
                            updateProgressCircle(0, newProgress.total);
                        }, 300);
                        
                    } else {
                        console.error('‚ùå Failed to save progress:', result.error);
                    }
                }
                
                // Log current data state
                console.log('üìã Current data after save:', currentData);
                
            } catch (error) {
                console.error('üí• Error in saveProgress:', error);
            }
        }

        function calculateProgress() {
            const vocabData = currentData.find(d => d.type === 'vocab');
            const readingData = currentData.find(d => d.type === 'reading');
            const grammarData = currentData.find(d => d.type === 'grammar');
            const lifeExpectancyData = currentData.find(d => d.type === 'life-expectancy');
            
            const vocab = vocabData ? vocabData.progress : 0;
            const reading = readingData ? readingData.progress : 0;
            const grammar = grammarData ? grammarData.progress : 0;
            const lifeExpectancy = lifeExpectancyData ? lifeExpectancyData.progress : 0;
            
            // T√≠nh t·ªïng ch·ªâ d·ª±a tr√™n 3 ph·∫ßn ch√≠nh: vocab, reading, grammar
            const total = Math.round((vocab + reading + grammar) / 3);
            
            return { total, vocab, reading, grammar, lifeExpectancy };
        }

        function updateProgressCircle(index, value) {
            const progressElements = document.querySelectorAll('.progress-ring-circle');
            const progressLabels = document.querySelectorAll('.progress-ring + div .font-bold');
            
            if (progressElements[index] && progressLabels[index]) {
                const radius = 35;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (value / 100) * circumference;
                
                progressElements[index].style.strokeDashoffset = offset;
                progressLabels[index].textContent = `${value}%`;
                
                console.log(`Progress circle ${index} updated to ${value}%`);
            }
        }

        function updateTotalProgress() {
            const progress = calculateProgress();
            console.log('üßÆ Calculating total progress:', progress);
            console.log(`üìä Individual progress - Vocab: ${progress.vocab}%, Reading: ${progress.reading}%, Grammar: ${progress.grammar}%`);
            console.log(`üéØ Total progress calculated: ${progress.total}%`);
            updateProgressCircle(0, progress.total); // total is index 0
            
            // Also update the DOM directly to ensure it shows
            const totalProgressElement = document.querySelector('.progress-ring + div .font-bold');
            if (totalProgressElement) {
                totalProgressElement.textContent = `${progress.total}%`;
                console.log(`‚úÖ Total progress DOM updated to: ${progress.total}%`);
            }
        }

        function updateProgressDisplay() {
            const progress = calculateProgress();
            console.log('üîÑ Updating progress display with:', progress);
            
            // Update all progress circles with detailed logging
            console.log(`üìä Updating circles - Total: ${progress.total}%, Vocab: ${progress.vocab}%, Reading: ${progress.reading}%, Grammar: ${progress.grammar}%`);
            
            updateProgressCircle(0, progress.total);
            updateProgressCircle(1, progress.vocab);
            updateProgressCircle(2, progress.reading);
            updateProgressCircle(3, progress.grammar);
            
            // Force update DOM elements directly
            const progressLabels = document.querySelectorAll('.progress-ring + div .font-bold');
            if (progressLabels.length >= 4) {
                progressLabels[0].textContent = `${progress.total}%`;
                progressLabels[1].textContent = `${progress.vocab}%`;
                progressLabels[2].textContent = `${progress.reading}%`;
                progressLabels[3].textContent = `${progress.grammar}%`;
                console.log('‚úÖ All progress labels updated directly');
            }
            
            console.log('‚úÖ All progress updated:', progress);
        }

        function pronounceWord(word) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 0.8;
                
                window.speechSynthesis.speak(utterance);
            }
        }

        function playCorrectSound() {
            // Create correct answer sound - cheerful ascending notes
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // Play a happy chord progression
            const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5
            let startTime = audioContext.currentTime;
            
            frequencies.forEach((freq, index) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                osc.frequency.setValueAtTime(freq, startTime + index * 0.1);
                osc.type = 'sine';
                
                gain.gain.setValueAtTime(0, startTime + index * 0.1);
                gain.gain.linearRampToValueAtTime(0.3, startTime + index * 0.1 + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + index * 0.1 + 0.4);
                
                osc.start(startTime + index * 0.1);
                osc.stop(startTime + index * 0.1 + 0.4);
            });
        }

        function playWrongSound() {
            // Create wrong answer sound - descending buzzer
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // Play descending buzzer sound
            const startTime = audioContext.currentTime;
            
            oscillator.frequency.setValueAtTime(200, startTime);
            oscillator.frequency.exponentialRampToValueAtTime(100, startTime + 0.5);
            oscillator.type = 'sawtooth';
            
            gainNode.gain.setValueAtTime(0, startTime);
            gainNode.gain.linearRampToValueAtTime(0.4, startTime + 0.05);
            gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.5);
            
            oscillator.start(startTime);
            oscillator.stop(startTime + 0.5);
        }

        document.addEventListener('keydown', (e) => {
            if (currentSection === 'vocab') {
                if (e.code === 'Space') {
                    e.preventDefault();
                    flipCard();
                } else if (e.code === 'ArrowLeft') {
                    e.preventDefault();
                    previousCard();
                } else if (e.code === 'ArrowRight') {
                    e.preventDefault();
                    nextCard();
                }
            }
        });

        // Add all navigation functions
        function startVocabQuiz() {
            currentVocabQuestion = 0;
            const config = window.elementSdk?.config || defaultConfig;
            renderContent(config);
        }

        function backToVocabQuizMenu() {
            currentVocabQuestion = -1;
            const config = window.elementSdk?.config || defaultConfig;
            renderContent(config);
        }

        function nextVocabQuestion() {
            if (currentVocabQuestion < vocabularyQuiz.length - 1) {
                currentVocabQuestion++;
                const config = window.elementSdk?.config || defaultConfig;
                renderContent(config);
            }
        }

        function previousVocabQuestion() {
            if (currentVocabQuestion > 0) {
                currentVocabQuestion--;
                const config = window.elementSdk?.config || defaultConfig;
                renderContent(config);
            }
        }

        function restoreVocabAnswer(questionIdx) {
            const question = vocabularyQuiz[questionIdx];
            const userAnswer = userAnswers[`vocab-${questionIdx}`];
            const selectedOption = userAnswers[`vocab-selected-${questionIdx}`];
            
            if (selectedOption !== undefined) {
                // Restore the visual state
                for (let i = 0; i < question.options.length; i++) {
                    const btn = document.getElementById(`vocab-q${questionIdx}-opt${i}`);
                    if (btn) {
                        btn.disabled = true;
                        btn.style.cursor = 'not-allowed';
                        
                        if (i === question.correct) {
                            // Always highlight the correct answer in green
                            btn.style.backgroundColor = '#22c55e';
                            btn.style.color = 'white';
                            btn.style.border = '2px solid #16a34a';
                            btn.style.fontWeight = 'bold';
                            btn.style.opacity = '1';
                        } else if (i === selectedOption && !userAnswer) {
                            // Highlight wrong answer in red
                            btn.style.backgroundColor = '#ef4444';
                            btn.style.color = 'white';
                            btn.style.border = '2px solid #dc2626';
                            btn.style.opacity = '1';
                        } else {
                            // Gray out other options
                            btn.style.backgroundColor = '#f3f4f6';
                            btn.style.color = '#6b7280';
                            btn.style.border = '2px solid #e5e7eb';
                            btn.style.opacity = '0.6';
                        }
                    }
                }
                
                const feedback = document.getElementById(`vocab-feedback-${questionIdx}`);
                if (feedback) {
                    if (userAnswer) {
                        feedback.innerHTML = '<span style="color: #22c55e; font-weight: bold;">‚úì Ch√≠nh x√°c!</span>';
                    } else {
                        feedback.innerHTML = `<span style="color: #ef4444; font-weight: bold;">‚úó Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√†: ${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}</span>`;
                    }
                }
            }
        }

        function startGrammarExercises() {
            currentGrammarQuestion = 0;
            const config = window.elementSdk?.config || defaultConfig;
            renderContent(config);
        }

        function backToGrammarExerciseMenu() {
            currentGrammarQuestion = -1;
            const config = window.elementSdk?.config || defaultConfig;
            renderContent(config);
        }

        function nextGrammarQuestion() {
            if (currentGrammarQuestion < grammarExercises.length - 1) {
                currentGrammarQuestion++;
                const config = window.elementSdk?.config || defaultConfig;
                renderContent(config);
            }
        }

        function previousGrammarQuestion() {
            if (currentGrammarQuestion > 0) {
                currentGrammarQuestion--;
                const config = window.elementSdk?.config || defaultConfig;
                renderContent(config);
            }
        }

        function restoreGrammarAnswer(questionIdx) {
            const question = grammarExercises[questionIdx];
            const userAnswer = userAnswers[`grammar-${questionIdx}`];
            const selectedOption = userAnswers[`grammar-selected-${questionIdx}`];
            
            if (selectedOption !== undefined) {
                // Restore the visual state
                for (let i = 0; i < question.options.length; i++) {
                    const btn = document.getElementById(`grammar-q${questionIdx}-opt${i}`);
                    if (btn) {
                        btn.disabled = true;
                        btn.style.cursor = 'not-allowed';
                        
                        if (i === question.correct) {
                            // Always highlight the correct answer in green
                            btn.style.backgroundColor = '#22c55e';
                            btn.style.color = 'white';
                            btn.style.border = '2px solid #16a34a';
                            btn.style.fontWeight = 'bold';
                            btn.style.opacity = '1';
                        } else if (i === selectedOption && !userAnswer) {
                            // Highlight wrong answer in red
                            btn.style.backgroundColor = '#ef4444';
                            btn.style.color = 'white';
                            btn.style.border = '2px solid #dc2626';
                            btn.style.opacity = '1';
                        } else {
                            // Gray out other options
                            btn.style.backgroundColor = '#f3f4f6';
                            btn.style.color = '#6b7280';
                            btn.style.border = '2px solid #e5e7eb';
                            btn.style.opacity = '0.6';
                        }
                    }
                }
                
                const feedback = document.getElementById(`grammar-feedback-${questionIdx}`);
                if (feedback) {
                    if (userAnswer) {
                        feedback.innerHTML = '<span style="color: #22c55e; font-weight: bold;">‚úì Ch√≠nh x√°c!</span>';
                    } else {
                        feedback.innerHTML = `<span style="color: #ef4444; font-weight: bold;">‚úó Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√†: ${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}</span>`;
                    }
                }
            }
        }

        window.switchSection = switchSection;
        window.flipCard = flipCard;
        window.nextCard = nextCard;
        window.previousCard = previousCard;
        window.selectGrammarTopic = selectGrammarTopic;
        window.backToGrammarMenu = backToGrammarMenu;
        window.checkReadingAnswer = checkReadingAnswer;
        window.startReadingQuiz = startReadingQuiz;
        window.backToReadingText = backToReadingText;
        window.nextReadingQuestion = nextReadingQuestion;
        window.previousReadingQuestion = previousReadingQuestion;
        window.checkGrammarAnswer = checkGrammarAnswer;
        window.startGrammarExercises = startGrammarExercises;
        window.backToGrammarExerciseMenu = backToGrammarExerciseMenu;
        window.nextGrammarQuestion = nextGrammarQuestion;
        window.previousGrammarQuestion = previousGrammarQuestion;
        window.selectVocabMode = selectVocabMode;
        window.backToVocabMenu = backToVocabMenu;
        window.checkVocabAnswer = checkVocabAnswer;
        window.startVocabQuiz = startVocabQuiz;
        window.backToVocabQuizMenu = backToVocabQuizMenu;
        window.nextVocabQuestion = nextVocabQuestion;
        window.previousVocabQuestion = previousVocabQuestion;
        window.checkLifeExpectancyAnswer = checkLifeExpectancyAnswer;
        window.pronounceWord = pronounceWord;

        initializeApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'997c27d484e9c6f3',t:'MTc2MjAwODExMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>